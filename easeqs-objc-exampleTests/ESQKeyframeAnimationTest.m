//
//  ESQKeyframeAnimation.m
//  easeqs-objc-example-tests
//
//  Created by Nik Burnt on 17.09.2017.
//  Copyright Â© 2017 Nik Burnt. All rights reserved.
//

#import <Specta/Specta.h>
#import <Expecta/Expecta.h>

#define ESQ_SHORT

#import <easeqs_objc/easeqs-objc-umbrella.h>

static NSString * const ESQKeyframeAnimationTest = @"Keyframe Animaiton Test";

static NSString * const ESQKeyframeAnimationKey = @"keyframeAnimation";
static NSString * const ESQKeyframeAnimationValuesKey = @"keyframeAnimationValues";

static const CGFloat ESQDefaultAnimationDuration = 2.f;

NS_INLINE NSNumber *roundedNumberFromNumberUsingFormatter(NSNumber *inputValue, NSNumberFormatter *numberFormatter) {
    NSString *stringRepresentation = [numberFormatter stringFromNumber:inputValue];
    NSNumber *value = [numberFormatter numberFromString:stringRepresentation];
    return value;
}

NS_INLINE NSNumber *roundedNumberFromFloatUsingFormatter(CGFloat inputValue, NSNumberFormatter *numberFormatter) {
    return roundedNumberFromNumberUsingFormatter(@(inputValue), numberFormatter);
}

#pragma mark - Shared

SharedExamplesBegin(CAKeyframeAnimationEaseqs)

sharedExamplesFor(ESQKeyframeAnimationTest, ^(NSDictionary *data) {
    
    CAKeyframeAnimation *keyframeAnimation = data[ESQKeyframeAnimationKey];
    NSArray<NSValue *> *keyframeAnimationInputValues = data[ESQKeyframeAnimationValuesKey];
    
    describe(@"this", ^{
        it(@"should exist", ^{
            expect(keyframeAnimation).toNot.beNil();
        });
        
        NSNumberFormatter *numberFormatter = [[NSNumberFormatter alloc] init];
        numberFormatter.numberStyle = NSNumberFormatterDecimalStyle;
        numberFormatter.maximumFractionDigits = 15;
        numberFormatter.roundingMode = NSNumberFormatterRoundHalfUp;
        
        id firstObject = keyframeAnimation.values.firstObject;
        BOOL isNumber = [firstObject isKindOfClass:NSNumber.class];
        BOOL isPoint = [firstObject isKindOfClass:NSValue.class] && [[firstObject description] hasPrefix:@"NSPoint"];
        BOOL isSize = [firstObject isKindOfClass:NSValue.class] && [[firstObject description] hasPrefix:@"NSSize"];
        NSMutableArray *easedValues = [[NSMutableArray alloc] init];
        [keyframeAnimation.values enumerateObjectsUsingBlock:^(id _Nonnull obj,
                                                               NSUInteger idx,
                                                               BOOL * _Nonnull stop) {
            if (isNumber) {
                [easedValues addObject:roundedNumberFromNumberUsingFormatter(obj, numberFormatter)];
            } else if (isPoint) {
                CGPoint point = [obj CGPointValue];
                [easedValues addObject:roundedNumberFromFloatUsingFormatter(point.x, numberFormatter)];
                [easedValues addObject:roundedNumberFromFloatUsingFormatter(point.y, numberFormatter)];
            } else if (isSize) {
                CGSize size = [obj CGSizeValue];
                [easedValues addObject:roundedNumberFromFloatUsingFormatter(size.width, numberFormatter)];
                [easedValues addObject:roundedNumberFromFloatUsingFormatter(size.height, numberFormatter)];
            }
        }];
        
        it(@"should match all values generated from easing function for animation frames to input values", ^{
            expect(easedValues).to.equal(keyframeAnimationInputValues);
        });
    });
    
});

SharedExamplesEnd

#pragma mark - Tests

SpecBegin(CAKeyframeAnimationEaseqs)

#pragma mark - CGFloat

describe(@"CAKeyframeAnimation created with selector esq_animationWithKeyPath:fromFloat:toFloat:duration:easingFunction: should match precalculated values", ^{
    ESQEasingFunction *easingFunction = [[ESQElasticEasingFunction alloc] init];
    NSArray *easedValues = @[ @0, @0.070465293941524, @0.162829065338087, @0.271762294668889, @0.391990134199997, @0.51845340289848, @0.646446615457535, @0.771728959342866, @0.890608509568942, @1.00000001159808, @1.09745676060877, @1.18117885333638, @1.25, @1.3033553645189, @1.34123397583185, @1.36411882685599, @1.37291725738912, @1.368886098557, @1.35355335474014, @1.32864014338105, @1.29598460461557, @1.25747085433555, @1.21496394951395, @1.17025243300058, @1.12500001490116, @1.08070596296494, @1.0386757051962, @0.999999981621625, @0.9655438314727049, @0.935943601581858, @0.9116116740339, @0.892747673188713, @0.879355551284923, @0.871264563971941, @0.868153844911846, @0.869579070165617, @0.875000022351742, @0.883808176417469, @0.895353640168516, @0.908970306190788, @0.923998766568946, @0.939806696896336, @0.955805855456193, @0.971466139870436, @0.986326080244004, @1.00000001299547, @1.01218210109993, @1.02264736003901, @1.03125000372529, @1.03791941577572, @1.0426542412715, @1.04551485345061, @1.04661465367301, @1.04611075219142, @1.04419417306781, @1.04108001425394, @1.0369980662289, @1.03218384590941, @1.02687048665401, @1.02128154581029, @1.01562499068678, @1.01008824712872, @1.00483446416206, @0.999999999373276, @0.99569298041247, @0.991992952867264, @0.988951461775427, @0.986593464121254, @0.984919451457924, @0.983908075937759, @0.983519232704729, @0.983697386591751, @0.984375005587935, @0.985476022931235, @0.98691920926052, @0.9886212938026741, @0.990499850995456, @0.992475840402437, @0.9944757345097071, @0.996433269348554, @0.99829076196736, @1.00000000324887, @1.00152276420555, @1.00283092123825, @1.00390625046566, @1.00473992785102, @1.00533178098865, @1.00568935505653, @1.00582683207872, @1.00576384437278, @1.00552426977083, @1.00513500178174, @1.00462475857196, @1.00402298156933, @1.00335881054563, @1.00266019421299, @1.00195312569849, @1.00126103148186, @1.0006043090574, @0.999999997781044, @0.999461620767136, @0.998999117276936, @0.99861893299713, @0.998324182370633, @0.998114931872263, @0.997988508195099, @0.997939905005802, @0.997962173077294, @0.998046875, @0.998184503439638, @0.998364900431565, @0.998577662033641, @0.99881248246712, @0.999059479701453, @0.999309467828565, @0.999554158439345, @0.999786346052627, @1.0000000000554, @1.00019034616741, @1 ];
    CAKeyframeAnimation *keyframeAnimation = [CAKeyframeAnimation esq_animationWithKeyPath:@"opacity" 
                                                                                 fromFloat:0 
                                                                                   toFloat:1
                                                                                  duration:ESQDefaultAnimationDuration 
                                                                            easingFunction:easingFunction];
    itBehavesLike(ESQKeyframeAnimationTest, @{ ESQKeyframeAnimationKey: keyframeAnimation,
                                               ESQKeyframeAnimationValuesKey: easedValues });
});

describe(@"CAKeyframeAnimation created with selector esq_animationWithKeyPath:fromFloat:toFloat:duration:easingCFunction:easingCFunctionParameters: should match precalculated values", ^{
    NSArray *defaultParameters = @[ @(ESQDefaultElasticAmplitude), @(ESQDefaultElasticPeriod) ];
    NSArray *easedValues = @[ @0, @0.070465293941524, @0.162829065338087, @0.271762294668889, @0.391990134199997, @0.51845340289848, @0.646446615457535, @0.771728959342866, @0.890608509568942, @1.00000001159808, @1.09745676060877, @1.18117885333638, @1.25, @1.3033553645189, @1.34123397583185, @1.36411882685599, @1.37291725738912, @1.368886098557, @1.35355335474014, @1.32864014338105, @1.29598460461557, @1.25747085433555, @1.21496394951395, @1.17025243300058, @1.12500001490116, @1.08070596296494, @1.0386757051962, @0.999999981621625, @0.9655438314727049, @0.935943601581858, @0.9116116740339, @0.892747673188713, @0.879355551284923, @0.871264563971941, @0.868153844911846, @0.869579070165617, @0.875000022351742, @0.883808176417469, @0.895353640168516, @0.908970306190788, @0.923998766568946, @0.939806696896336, @0.955805855456193, @0.971466139870436, @0.986326080244004, @1.00000001299547, @1.01218210109993, @1.02264736003901, @1.03125000372529, @1.03791941577572, @1.0426542412715, @1.04551485345061, @1.04661465367301, @1.04611075219142, @1.04419417306781, @1.04108001425394, @1.0369980662289, @1.03218384590941, @1.02687048665401, @1.02128154581029, @1.01562499068678, @1.01008824712872, @1.00483446416206, @0.999999999373276, @0.99569298041247, @0.991992952867264, @0.988951461775427, @0.986593464121254, @0.984919451457924, @0.983908075937759, @0.983519232704729, @0.983697386591751, @0.984375005587935, @0.985476022931235, @0.98691920926052, @0.9886212938026741, @0.990499850995456, @0.992475840402437, @0.9944757345097071, @0.996433269348554, @0.99829076196736, @1.00000000324887, @1.00152276420555, @1.00283092123825, @1.00390625046566, @1.00473992785102, @1.00533178098865, @1.00568935505653, @1.00582683207872, @1.00576384437278, @1.00552426977083, @1.00513500178174, @1.00462475857196, @1.00402298156933, @1.00335881054563, @1.00266019421299, @1.00195312569849, @1.00126103148186, @1.0006043090574, @0.999999997781044, @0.999461620767136, @0.998999117276936, @0.99861893299713, @0.998324182370633, @0.998114931872263, @0.997988508195099, @0.997939905005802, @0.997962173077294, @0.998046875, @0.998184503439638, @0.998364900431565, @0.998577662033641, @0.99881248246712, @0.999059479701453, @0.999309467828565, @0.999554158439345, @0.999786346052627, @1.0000000000554, @1.00019034616741, @1 ];
    CAKeyframeAnimation *keyframeAnimation = [CAKeyframeAnimation esq_animationWithKeyPath:@"opacity" 
                                                                                 fromFloat:0 
                                                                                   toFloat:1
                                                                                  duration:ESQDefaultAnimationDuration 
                                                                            easingCFunction:elasticOut
                                                                 easingCFunctionParameters:defaultParameters];
    itBehavesLike(ESQKeyframeAnimationTest, @{ ESQKeyframeAnimationKey: keyframeAnimation,
                                               ESQKeyframeAnimationValuesKey: easedValues });
});

#pragma mark - CGPoint

describe(@"CAKeyframeAnimation created with selector esq_animationWithKeyPath:fromPoint:toPoint:duration:easingFunction: should match precalculated values", ^{
    ESQEasingFunction *easingFunction = [[ESQBackEasingFunction alloc] init];
    NSArray *easedValues = @[ @0, @0, @3.87367352461903, @1.93683676230951, @7.65935230963586, @3.82967615481793, @11.3579744038249, @5.67898720191244, @14.9704778559605, @7.48523892798026, @18.4978007148172, @9.2489003574086, @21.9408810291693, @10.9704405145847, @25.3006568477912, @12.6503284238956, @28.5780662194575, @14.2890331097287, @31.7740471929423, @15.8870235964712, @34.8895378170203, @17.4447689085101, @37.9254761404657, @18.9627380702329, @40.882800212053, @20.4414001060265, @43.7624480805567, @21.8812240402783, @46.5653577947511, @23.2826788973755, @49.2924674034106, @24.6462337017053, @51.9447149553096, @25.9723574776548, @54.5230384992226, @27.2615192496113, @57.0283760839239, @28.514188041962, @59.4616657581881, @29.730832879094, @61.8238455707893, @30.9119227853947, @64.1158535705023, @32.0579267852511, @66.3386278061012, @33.1693139030506, @68.4931063263605, @34.2465531631802, @70.58022718005461, @35.2901135900273, @72.60092841595799, @36.300464207979, @74.556148082845, @37.2780740414225, @76.4468242294901, @38.2234121147451, @78.2738949046677, @39.1369474523338, @80.0382981571521, @40.0191490785761, @81.7409720357178, @40.8704860178589, @83.3828545891393, @41.6914272945696, @84.9648838661908, @42.4824419330954, @86.4879979156469, @43.2439989578234, @87.95313478628189, @43.9765673931409, @89.3612325268702, @44.6806162634351, @90.7132291861863, @45.3566145930931, @92.0100628130045, @46.0050314065023, @93.25267145609941, @46.6263357280497, @94.4419931642452, @47.2209965821226, @95.5789659862164, @47.7894829931082, @96.6645279707874, @48.3322639853937, @97.69961716673269, @48.8498085833663, @98.6851716228265, @49.3425858114133, @99.6221293878434, @49.8110646939217, @100.511428510558, @50.2557142552789, @101.354007039744, @50.677003519872, @102.150803024176, @51.0754015120882, @102.90275451263, @51.4513772563148, @103.610799553878, @51.8053997769389, @104.275876196696, @52.1379380983478, @104.898922489857, @52.4494612449286, @105.480876482137, @52.7404382410686, @106.02267622231, @53.011338111155, @106.52525975915, @53.2626298795749, @106.989565141431, @53.4947825707156, @107.416530417929, @53.7082652089643, @107.807093637416, @53.9035468187082, @108.162192848669, @54.0810964243345, @108.482766100461, @54.2413830502304, @108.769751441566, @54.384875720783, @109.024086920759, @54.5120434603797, @109.246710586815, @54.6233552934076, @109.438560488508, @54.719280244254, @109.600574674612, @54.8002873373059, @109.733691193901, @54.8668455969507, @109.838848095151, @54.9194240475755, @109.916983427135, @54.9584917135676, @109.969035238628, @54.9845176193141, @109.995941578404, @54.9979707892022, @109.998640495238, @54.9993202476192, @109.978070037905, @54.9890350189523, @109.935168255177, @54.9675841275887, @109.870873195831, @54.9354365979155, @109.78612290864, @54.89306145432, @109.681855442379, @54.8409277211893, @109.559008845822, @54.7795044229108, @109.418521167743, @54.7092605838716, @109.261330456918, @54.6306652284588, @109.08837476212, @54.5441873810598, @108.900592132123, @54.4502960660617, @108.698920615703, @54.3494603078517, @108.484298261634, @54.242149130817, @108.25766311869, @54.1288315593448, @108.019953235645, @54.0099766178224, @107.772106661274, @53.8860533306369, @107.515061444351, @53.7575307221756, @107.249755633651, @53.6248778168256, @106.977127277948, @53.4885636389741, @106.698114426017, @53.3490572130084, @106.413655126631, @53.2068275633157, @106.124687428566, @53.0623437142831, @105.832149380596, @52.916074690298, @105.536979031495, @52.7684895157473, @105.240114430037, @52.6200572150185, @104.942493624997, @52.4712468124987, @104.64505466515, @52.3225273325751, @104.34873559927, @52.1743677996348, @104.05447447613, @52.0272372380652, @103.763209344507, @51.8816046722534, @103.475878253173, @51.7379391265866, @103.193419250904, @51.596709625452, @102.916770386474, @51.4583851932369, @102.646869708657, @51.3234348543283, @102.384655266227, @51.1923276331137, @102.13106510796, @51.06553255398, @101.887037282629, @50.9435186413146, @101.653509839009, @50.8267549195047, @101.431420825875, @50.7157104129374, @101.221708292, @50.610854146, @101.025310286159, @50.5126551430797, @100.843164857127, @50.4215824285636, @100.676210053678, @50.338105026839, @100.525383924586, @50.2626919622931, @100.391624518626, @50.1958122593131, @100.275869884572, @50.1379349422862, @100.179058071199, @50.0895290355996, @100.102127127281, @50.0510635636405, @100.046015101592, @50.0230075507961, @100, @50 ];
    CAKeyframeAnimation *keyframeAnimation = [CAKeyframeAnimation esq_animationWithKeyPath:@"opacity" 
                                                                                 fromPoint:CGPointZero 
                                                                                   toPoint:CGPointMake(100, 50) 
                                                                                  duration:ESQDefaultAnimationDuration
                                                                            easingFunction:easingFunction];
    itBehavesLike(ESQKeyframeAnimationTest, @{ ESQKeyframeAnimationKey: keyframeAnimation,
                                               ESQKeyframeAnimationValuesKey: easedValues });
});

describe(@"CAKeyframeAnimation created with selector esq_animationWithKeyPath:fromPoint:toPoint:duration:easingCFunction:easingCFunctionParameters: should match precalculated values", ^{
    NSArray *defaultParameters = @[ @(ESQDefaultBackOvershotValue) ];
    NSArray *easedValues = @[ @0, @0, @3.87367352461903, @1.93683676230951, @7.65935230963586, @3.82967615481793, @11.3579744038249, @5.67898720191244, @14.9704778559605, @7.48523892798026, @18.4978007148172, @9.2489003574086, @21.9408810291693, @10.9704405145847, @25.3006568477912, @12.6503284238956, @28.5780662194575, @14.2890331097287, @31.7740471929423, @15.8870235964712, @34.8895378170203, @17.4447689085101, @37.9254761404657, @18.9627380702329, @40.882800212053, @20.4414001060265, @43.7624480805567, @21.8812240402783, @46.5653577947511, @23.2826788973755, @49.2924674034106, @24.6462337017053, @51.9447149553096, @25.9723574776548, @54.5230384992226, @27.2615192496113, @57.0283760839239, @28.514188041962, @59.4616657581881, @29.730832879094, @61.8238455707893, @30.9119227853947, @64.1158535705023, @32.0579267852511, @66.3386278061012, @33.1693139030506, @68.4931063263605, @34.2465531631802, @70.58022718005461, @35.2901135900273, @72.60092841595799, @36.300464207979, @74.556148082845, @37.2780740414225, @76.4468242294901, @38.2234121147451, @78.2738949046677, @39.1369474523338, @80.0382981571521, @40.0191490785761, @81.7409720357178, @40.8704860178589, @83.3828545891393, @41.6914272945696, @84.9648838661908, @42.4824419330954, @86.4879979156469, @43.2439989578234, @87.95313478628189, @43.9765673931409, @89.3612325268702, @44.6806162634351, @90.7132291861863, @45.3566145930931, @92.0100628130045, @46.0050314065023, @93.25267145609941, @46.6263357280497, @94.4419931642452, @47.2209965821226, @95.5789659862164, @47.7894829931082, @96.6645279707874, @48.3322639853937, @97.69961716673269, @48.8498085833663, @98.6851716228265, @49.3425858114133, @99.6221293878434, @49.8110646939217, @100.511428510558, @50.2557142552789, @101.354007039744, @50.677003519872, @102.150803024176, @51.0754015120882, @102.90275451263, @51.4513772563148, @103.610799553878, @51.8053997769389, @104.275876196696, @52.1379380983478, @104.898922489857, @52.4494612449286, @105.480876482137, @52.7404382410686, @106.02267622231, @53.011338111155, @106.52525975915, @53.2626298795749, @106.989565141431, @53.4947825707156, @107.416530417929, @53.7082652089643, @107.807093637416, @53.9035468187082, @108.162192848669, @54.0810964243345, @108.482766100461, @54.2413830502304, @108.769751441566, @54.384875720783, @109.024086920759, @54.5120434603797, @109.246710586815, @54.6233552934076, @109.438560488508, @54.719280244254, @109.600574674612, @54.8002873373059, @109.733691193901, @54.8668455969507, @109.838848095151, @54.9194240475755, @109.916983427135, @54.9584917135676, @109.969035238628, @54.9845176193141, @109.995941578404, @54.9979707892022, @109.998640495238, @54.9993202476192, @109.978070037905, @54.9890350189523, @109.935168255177, @54.9675841275887, @109.870873195831, @54.9354365979155, @109.78612290864, @54.89306145432, @109.681855442379, @54.8409277211893, @109.559008845822, @54.7795044229108, @109.418521167743, @54.7092605838716, @109.261330456918, @54.6306652284588, @109.08837476212, @54.5441873810598, @108.900592132123, @54.4502960660617, @108.698920615703, @54.3494603078517, @108.484298261634, @54.242149130817, @108.25766311869, @54.1288315593448, @108.019953235645, @54.0099766178224, @107.772106661274, @53.8860533306369, @107.515061444351, @53.7575307221756, @107.249755633651, @53.6248778168256, @106.977127277948, @53.4885636389741, @106.698114426017, @53.3490572130084, @106.413655126631, @53.2068275633157, @106.124687428566, @53.0623437142831, @105.832149380596, @52.916074690298, @105.536979031495, @52.7684895157473, @105.240114430037, @52.6200572150185, @104.942493624997, @52.4712468124987, @104.64505466515, @52.3225273325751, @104.34873559927, @52.1743677996348, @104.05447447613, @52.0272372380652, @103.763209344507, @51.8816046722534, @103.475878253173, @51.7379391265866, @103.193419250904, @51.596709625452, @102.916770386474, @51.4583851932369, @102.646869708657, @51.3234348543283, @102.384655266227, @51.1923276331137, @102.13106510796, @51.06553255398, @101.887037282629, @50.9435186413146, @101.653509839009, @50.8267549195047, @101.431420825875, @50.7157104129374, @101.221708292, @50.610854146, @101.025310286159, @50.5126551430797, @100.843164857127, @50.4215824285636, @100.676210053678, @50.338105026839, @100.525383924586, @50.2626919622931, @100.391624518626, @50.1958122593131, @100.275869884572, @50.1379349422862, @100.179058071199, @50.0895290355996, @100.102127127281, @50.0510635636405, @100.046015101592, @50.0230075507961, @100, @50 ];
    CAKeyframeAnimation *keyframeAnimation = [CAKeyframeAnimation esq_animationWithKeyPath:@"opacity" 
                                                                                 fromPoint:CGPointZero 
                                                                                   toPoint:CGPointMake(100, 50) 
                                                                                  duration:ESQDefaultAnimationDuration
                                                                           easingCFunction:backOut
                                                                 easingCFunctionParameters:defaultParameters];
    itBehavesLike(ESQKeyframeAnimationTest, @{ ESQKeyframeAnimationKey: keyframeAnimation,
                                               ESQKeyframeAnimationValuesKey: easedValues });
});

#pragma mark - Size

describe(@"CAKeyframeAnimation created with selector esq_animationWithKeyPath:fromSize:toSize:duration:easingFunction: should match precalculated values", ^{
    ESQEasingFunction *easingFunction = [[ESQQuadraticEasingFunction alloc] init];
    NSArray *easedValues = @[ @0, @0, @4.9791669252639, @3.3194446168426, @9.91666717951497, @6.61111145300998, @14.8125007627532, @9.875000508502129, @19.6666676749786, @13.111111783319, @24.4791679161911, @16.3194452774607, @29.2500014863908, @19.5000009909272, @33.9791683855777, @22.6527789237185, @38.6666686137517, @25.7777790758345, @43.3125021709129, @28.8750014472753, @47.9166690570613, @31.9444460380408, @52.4791692721968, @34.9861128481312, @57.0000028163195, @38.0000018775463, @61.4791696894293, @40.9861131262862, @65.9166698915263, @43.9444465943509, @70.3125034226104, @46.8750022817403, @74.66667028268181, @49.7777801884545, @78.9791704717402, @52.6527803144935, @83.2500039897859, @55.5000026598573, @87.4791708368187, @58.3194472245458, @91.66667101283871, @61.1111140085591, @95.8125045178458, @63.8750030118972, @99.91667135184009, @66.61111423456001, @103.979171514822, @69.3194476765477, @108.00000500679, @72.00000333786009, @111.979171827746, @74.6527812184973, @115.916671977689, @77.2777813184592, @119.812505456619, @79.87500363774591, @123.666672264536, @82.4444481763575, @127.479172401441, @84.9861149342937, @131.250005867332, @87.5000039115548, @134.979172662211, @89.98611510814059, @138.666672786077, @92.4444485240512, @142.31250623893, @94.8750041592866, @145.91667302077, @97.2777820138467, @149.479173131597, @99.65278208773169, @153.000006571412, @102.000004380941, @156.479173340214, @104.319448893476, @159.916673438003, @106.611115625335, @163.312506864779, @108.875004576519, @166.666673620542, @111.111115747028, @169.979173705292, @113.319449136861, @173.25000711903, @115.50000474602, @176.479173861754, @117.652782574503, @179.666673933466, @119.777782622311, @182.812507334165, @121.875004889443, @185.916674063851, @123.944449375901, @188.979174122525, @125.986116081683, @192.000007510185, @128.00000500679, @194.979174226833, @129.986116151222, @197.916674272468, @131.944449514978, @200.81250764709, @133.87500509806, @203.666674350699, @135.777782900466, @206.479174383295, @137.652782922197, @209.250007744878, @139.500005163252, @211.979174435449, @141.319449623633, @214.666674455007, @143.111116303338, @217.312507803552, @144.875005202368, @219.916674481084, @146.611116320722, @222.479174487603, @148.319449658402, @225.000007823109, @150.000005215406, @227.479174487603, @151.652782991735, @229.916674481084, @153.277782987389, @232.312507803552, @154.875005202368, @234.666674455007, @156.444449636671, @236.979174435449, @157.986116290299, @239.250007744878, @159.500005163252, @241.479174383295, @160.98611625553, @243.666674350699, @162.444449567132, @245.812507647089, @163.87500509806, @247.916674272467, @165.277782848312, @249.979174226833, @166.652782817888, @252.000007510185, @168.00000500679, @253.979174122524, @169.319449415016, @255.916674063851, @170.611116042567, @257.812507334165, @171.875004889443, @259.666673933466, @173.111115955644, @261.479173861754, @174.319449241169, @263.250007119029, @175.50000474602, @264.979173705292, @176.652782470195, @266.666673620542, @177.777782413694, @268.312506864778, @178.875004576519, @269.916673438002, @179.944448958668, @271.479173340213, @180.986115560142, @273.000006571412, @182.000004380941, @274.479173131597, @182.986115421065, @275.91667302077, @183.944448680513, @277.312506238929, @184.875004159286, @278.666672786076, @185.777781857384, @279.97917266221, @186.652781774807, @281.250005867332, @187.500003911555, @282.47917240144, @188.319448267627, @283.666672264536, @189.111114843024, @284.812505456618, @189.875003637746, @285.916671977688, @190.611114651792, @286.979171827745, @191.319447885164, @288.00000500679, @192.00000333786, @288.979171514821, @192.652781009881, @289.91667135184, @193.277780901226, @290.812504517845, @193.875003011897, @291.666671012838, @194.444447341892, @292.479170836818, @194.986113891212, @293.250003989785, @195.500002659857, @293.97917047174, @195.986113647826, @294.666670282681, @196.444446855121, @295.31250342261, @196.87500228174, @295.916669891526, @197.277779927684, @296.479169689429, @197.652779792952, @297.000002816319, @198.000001877546, @297.479169272196, @198.319446181464, @297.916669057061, @198.611112704707, @298.312502170912, @198.875001447275, @298.666668613751, @199.111112409167, @298.979168385577, @199.319445590385, @299.25000148639, @199.500000990927, @299.47916791619, @199.652778610794, @299.666667674978, @199.777778449985, @299.812500762752, @199.875000508502, @299.916667179514, @199.944444786343, @300, @200 ];
    CAKeyframeAnimation *keyframeAnimation = [CAKeyframeAnimation esq_animationWithKeyPath:@"opacity" 
                                                                                 fromSize:CGSizeZero
                                                                                    toSize:CGSizeMake(300, 200)
                                                                                  duration:ESQDefaultAnimationDuration
                                                                            easingFunction:easingFunction];
    itBehavesLike(ESQKeyframeAnimationTest, @{ ESQKeyframeAnimationKey: keyframeAnimation,
                                               ESQKeyframeAnimationValuesKey: easedValues });
});

describe(@"CAKeyframeAnimation created with selector esq_animationWithKeyPath:fromSize:toSize:duration:easingCFunction:easingCFunctionParameters: should match precalculated values", ^{
    NSArray *easedValues = @[ @0, @0, @4.9791669252639, @3.3194446168426, @9.91666717951497, @6.61111145300998, @14.8125007627532, @9.875000508502129, @19.6666676749786, @13.111111783319, @24.4791679161911, @16.3194452774607, @29.2500014863908, @19.5000009909272, @33.9791683855777, @22.6527789237185, @38.6666686137517, @25.7777790758345, @43.3125021709129, @28.8750014472753, @47.9166690570613, @31.9444460380408, @52.4791692721968, @34.9861128481312, @57.0000028163195, @38.0000018775463, @61.4791696894293, @40.9861131262862, @65.9166698915263, @43.9444465943509, @70.3125034226104, @46.8750022817403, @74.66667028268181, @49.7777801884545, @78.9791704717402, @52.6527803144935, @83.2500039897859, @55.5000026598573, @87.4791708368187, @58.3194472245458, @91.66667101283871, @61.1111140085591, @95.8125045178458, @63.8750030118972, @99.91667135184009, @66.61111423456001, @103.979171514822, @69.3194476765477, @108.00000500679, @72.00000333786009, @111.979171827746, @74.6527812184973, @115.916671977689, @77.2777813184592, @119.812505456619, @79.87500363774591, @123.666672264536, @82.4444481763575, @127.479172401441, @84.9861149342937, @131.250005867332, @87.5000039115548, @134.979172662211, @89.98611510814059, @138.666672786077, @92.4444485240512, @142.31250623893, @94.8750041592866, @145.91667302077, @97.2777820138467, @149.479173131597, @99.65278208773169, @153.000006571412, @102.000004380941, @156.479173340214, @104.319448893476, @159.916673438003, @106.611115625335, @163.312506864779, @108.875004576519, @166.666673620542, @111.111115747028, @169.979173705292, @113.319449136861, @173.25000711903, @115.50000474602, @176.479173861754, @117.652782574503, @179.666673933466, @119.777782622311, @182.812507334165, @121.875004889443, @185.916674063851, @123.944449375901, @188.979174122525, @125.986116081683, @192.000007510185, @128.00000500679, @194.979174226833, @129.986116151222, @197.916674272468, @131.944449514978, @200.81250764709, @133.87500509806, @203.666674350699, @135.777782900466, @206.479174383295, @137.652782922197, @209.250007744878, @139.500005163252, @211.979174435449, @141.319449623633, @214.666674455007, @143.111116303338, @217.312507803552, @144.875005202368, @219.916674481084, @146.611116320722, @222.479174487603, @148.319449658402, @225.000007823109, @150.000005215406, @227.479174487603, @151.652782991735, @229.916674481084, @153.277782987389, @232.312507803552, @154.875005202368, @234.666674455007, @156.444449636671, @236.979174435449, @157.986116290299, @239.250007744878, @159.500005163252, @241.479174383295, @160.98611625553, @243.666674350699, @162.444449567132, @245.812507647089, @163.87500509806, @247.916674272467, @165.277782848312, @249.979174226833, @166.652782817888, @252.000007510185, @168.00000500679, @253.979174122524, @169.319449415016, @255.916674063851, @170.611116042567, @257.812507334165, @171.875004889443, @259.666673933466, @173.111115955644, @261.479173861754, @174.319449241169, @263.250007119029, @175.50000474602, @264.979173705292, @176.652782470195, @266.666673620542, @177.777782413694, @268.312506864778, @178.875004576519, @269.916673438002, @179.944448958668, @271.479173340213, @180.986115560142, @273.000006571412, @182.000004380941, @274.479173131597, @182.986115421065, @275.91667302077, @183.944448680513, @277.312506238929, @184.875004159286, @278.666672786076, @185.777781857384, @279.97917266221, @186.652781774807, @281.250005867332, @187.500003911555, @282.47917240144, @188.319448267627, @283.666672264536, @189.111114843024, @284.812505456618, @189.875003637746, @285.916671977688, @190.611114651792, @286.979171827745, @191.319447885164, @288.00000500679, @192.00000333786, @288.979171514821, @192.652781009881, @289.91667135184, @193.277780901226, @290.812504517845, @193.875003011897, @291.666671012838, @194.444447341892, @292.479170836818, @194.986113891212, @293.250003989785, @195.500002659857, @293.97917047174, @195.986113647826, @294.666670282681, @196.444446855121, @295.31250342261, @196.87500228174, @295.916669891526, @197.277779927684, @296.479169689429, @197.652779792952, @297.000002816319, @198.000001877546, @297.479169272196, @198.319446181464, @297.916669057061, @198.611112704707, @298.312502170912, @198.875001447275, @298.666668613751, @199.111112409167, @298.979168385577, @199.319445590385, @299.25000148639, @199.500000990927, @299.47916791619, @199.652778610794, @299.666667674978, @199.777778449985, @299.812500762752, @199.875000508502, @299.916667179514, @199.944444786343, @300, @200 ];
    CAKeyframeAnimation *keyframeAnimation = [CAKeyframeAnimation esq_animationWithKeyPath:@"opacity" 
                                                                                  fromSize:CGSizeZero
                                                                                    toSize:CGSizeMake(300, 200)
                                                                                  duration:ESQDefaultAnimationDuration
                                                                            easingCFunction:quadraticOut
                                                                 easingCFunctionParameters:nil];
    itBehavesLike(ESQKeyframeAnimationTest, @{ ESQKeyframeAnimationKey: keyframeAnimation,
                                               ESQKeyframeAnimationValuesKey: easedValues });
});

SpecEnd
